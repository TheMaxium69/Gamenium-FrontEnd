<!-- MODAL -->
<modal-note></modal-note>
<modal-view-mygame></modal-view-mygame>
<modal-add-game-unselect></modal-add-game-unselect>

<!-- CONTENT-->
<section id="profilWrapper" class="container">

  <article class="navigateBar">

    <ul style="background-color: {{ isColor }}">

      <!-- HOME PAGE -->
      <ng-container *ngIf="!task">
        <li routerLink="/mygame/" class="active">
          <p>HOME</p>
        </li>
      </ng-container>
      <ng-container *ngIf="task">
        <li routerLink="/mygame/">
          <p>HOME</p>
        </li>
      </ng-container>

      <!-- RECENT PAGE -->
      <ng-container *ngIf="task == 'recent'">
        <li routerLink="/mygame/recent" class="active">
          <p>RECENT</p>
        </li>
      </ng-container>
      <ng-container *ngIf="task != 'recent'">
        <li routerLink="/mygame/recent">
          <p>RECENT</p>
        </li>
      </ng-container>

      <!-- OTHER PAGE     -->
      <li>
        <p>SAMPLE</p>
      </li>
      <li>
        <p>SAMPLE</p>
      </li>

    </ul>

  </article>

  <!-- PAGE HOME-->
  <ng-container *ngIf="!task">

    <!--  GAME PINED -->

    <div id="show-game" class="d-flex container">
      <ng-container *ngFor="let myGameHistorique of getPinnedGames()">
        <div class="card-wrapper">
          <div class="card-game container d-flex">

            <div class="isPinned" style="background-color: {{ isColor }}">
              <p><i class="ri-pushpin-fill"></i></p>
            </div>

            <!--          <div class="card-left" (click)="goToGame(myGameHistorique.myGame.game.id)" >-->
            <div class="card-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame" >
              <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url == 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
                <div class="image" style="background-image: url('https://tyrolium.fr/Contenu/Image/Soon.png')"></div>
                <div class="blur"></div>
                <img src="https://tyrolium.fr/Contenu/Image/Soon.png" alt="...">
              </ng-container>
              <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url != 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
                <div class="image" style="background-image: url('{{ myGameHistorique.myGame.game.image?.thumb_url }}')"></div>
                <div class="blur"></div>
                <img src="{{ myGameHistorique.myGame.game.image?.thumb_url }}" alt="...">
              </ng-container>
            </div>

            <div class="card-right d-flex">
              <div class="core-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame">
                <h2>{{ myGameHistorique.myGame.game.name }}</h2>
                <p style="color: {{ isColor }};" class="platform-names">
                  <ng-container *ngFor="let platform of myGameHistorique.myGame.game.platforms; let last = last">
                    {{ platform.name }}<span *ngIf="!last">, </span>
                  </ng-container>
                </p>
                <!--              <ng-container *ngIf="myGameHistorique.buy_at">-->
                <!--                <p> [QUAND] Acheté le : {{ myGameHistorique.buy_at }}</p>-->
                <!--              </ng-container>-->
                <!--              <ng-container *ngIf="myGameHistorique.buywhere">-->
                <!--                <p> [LIEU] Où : {{ myGameHistorique.buywhere.name }}</p>-->
                <!--              </ng-container>-->
                <p> Ajouté le : {{ myGameHistorique.myGame.added_at | date:'dd / MM / yyyy' }}</p>
              </div>
              <div class="core-right">
                <div class="card-note" style="background-color: {{ isColor }}">
                  <p><span id="noteGame{{ myGameHistorique.myGame.game.id }}">
                    <ng-container *ngIf="!userRatingAll">na</ng-container>
                    <ng-container *ngIf="userRatingAll">
                      <ng-container *ngIf="hasUserRatings(myGameHistorique.myGame.game.id)">
                        <ng-container *ngFor="let userRating of userRatingAll">
                          <ng-container *ngIf="userRating.game.id == myGameHistorique.myGame.game.id">{{ userRating.rating }}</ng-container>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="!hasUserRatings(myGameHistorique.myGame.game.id)">na</ng-container>
                    </ng-container>
                  </span>/20</p>
                </div>
                <div class="card-action">
                  <i (click)="togglePin(myGameHistorique); $event.stopPropagation()" class="ri-unpin-line"></i>
                  <i (click)="setModal(myGameHistorique.myGame.game); $event.stopPropagation(); " data-bs-toggle="modal" data-bs-target="#noteGame" class="ri-star-line"></i>
                  <i routerLink="edit/{{ myGameHistorique.id }}" class="ri-pencil-line"></i>
                  <!--                <i (click)="selectGame(myGameHistorique.myGame.game); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#editGamePage" class="ri-pencil-line"></i>-->
                  <!--                <i id="delete-comment-icon" class="ri-delete-bin-line" style="color: red;"-->
                  <!--                (click)="deleteFromMyGame(myGameHistorique.myGame.game.id)"></i>-->
                </div>
              </div>
            </div>

          </div>
        </div>

      </ng-container>
    </div>

    <article class="articleTuto">
      <div class="row ">
        <div class="col-md-12 py-4 hello">
          <h2 class="text-center">Bonjour, <span class="pseudo" style="color: {{ isColor }};">{{ userConnected?.displayname }}</span></h2>
        </div>
      </div>

      <div class="row">

        <div class="col-md-6 actionPossible">
          <div class="action">

            <h3 class="text-center py-4 mb-0">Que Souhaitez-vous faire ?</h3>

            <div class=" ">

              <div class="row">
                <div class="col-lg-6 ">
                  <article (click)="unsetModal()" class="card py-4 mb-3 mx-auto" data-bs-toggle="modal" data-bs-target="#ajouteGamePage">
                    <i class="ri-add-circle-line"></i>
                    <h6>Ajoutez un jeu</h6>
                  </article>
                </div>
                <div class="col-lg-6">
                  <article (click)="unsetModal()" class="card py-4 mx-auto" data-bs-toggle="modal" data-bs-target="#noteGamePage">
                    <i class="ri-star-half-line"></i>
                    <h6>Ajoutez une note</h6>
                  </article>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-lg-6">
                  <article class="card py-4 mb-3 mx-auto" routerLink="/profil/{{ userConnected?.id }}">
                    <i class="ri-profile-line"></i>
                    <h6>Votre profil public</h6>
                  </article>
                </div>
                <div class="col-lg-6 ">
                  <article class="card py-4 mx-auto" routerLink="/profil/{{ userConnected?.id }}">
                    <i class="ri-settings-3-line"></i>
                    <h6>Éditer votre profil</h6>
                  </article>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-5 offset-md-1 taskPossible">
          <div class="task">
            <h3 class="text-center py-4 mb-0">Vos tâches</h3>
            <p class="">Finaliser vos tâches :</p>

            <div class="progress-bar-container">
              <div class="progress-bar" style="background-color: {{ isColor }}" [style.width.%]="progress"></div>
            </div>


            <h3>Pour finaliser votre compte :</h3>
            <br>
            <ng-container *ngFor="let task of tasks">
              <!-- Tache -->
              <h6>
                <!-- Cercle remplis ou vide selon si completé -->
                <i *ngIf="task.completed" class="ri-checkbox-circle-fill"></i>
                <i *ngIf="!task.completed" class="ri-checkbox-blank-circle-line"></i>
                {{ task.name }}
              </h6>
            </ng-container>
          </div>

        </div>
      </div>
    </article>

    <!-- SECTION BARRE DE RECHERCHE -->
    <div class="row search-bar">
      <div class="col-md-12 border">
        <h2 class="text-center">ICI BARRE DE RECHERCHE</h2>
      </div>
    </div>



    <!-- UNPINNED GAME -->
    <div id="show-game" class="d-flex container">
      <ng-container *ngFor="let myGameHistorique of getUnpinnedGames()">
        <div class="card-wrapper">
          <div class="card-game container d-flex">

            <div class="card-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame">
              <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url == 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
                <div class="image" style="background-image: url('https://tyrolium.fr/Contenu/Image/Soon.png')"></div>
                <div class="blur"></div>
                <img src="https://tyrolium.fr/Contenu/Image/Soon.png" alt="...">
              </ng-container>
              <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url != 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
                <div class="image" style="background-image: url('{{ myGameHistorique.myGame.game.image?.thumb_url }}')"></div>
                <div class="blur"></div>
                <img src="{{ myGameHistorique.myGame.game.image?.thumb_url }}" alt="...">
              </ng-container>
            </div>

            <div class="card-right d-flex">
              <div class="core-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame">
                <h2>{{ myGameHistorique.myGame.game.name }}</h2>
                <p style="color: {{ isColor }};" class="platform-names">
                  <ng-container *ngFor="let platform of myGameHistorique.myGame.game.platforms; let last = last">
                    {{ platform.name }}<span *ngIf="!last">, </span>
                  </ng-container>
                </p>
                <!--              <ng-container *ngIf="myGameHistorique.buy_at">-->
                <!--                <p> [QUAND] Acheté le : {{ myGameHistorique.buy_at }}</p>-->
                <!--              </ng-container>-->
                <!--              <ng-container *ngIf="myGameHistorique.buywhere">-->
                <!--                <p> [LIEU] Où : {{ myGameHistorique.buywhere.name }}</p>-->
                <!--              </ng-container>-->
                <p> Ajouté le : {{ myGameHistorique.myGame.added_at | date:'dd / MM / yyyy' }}</p>
              </div>
              <div class="core-right">
                <div class="card-note" style="background-color: {{ isColor }}">
                  <p><span id="noteGame{{ myGameHistorique.myGame.game.id }}">
                    <ng-container *ngIf="!userRatingAll">na</ng-container>
                    <ng-container *ngIf="userRatingAll">
                      <ng-container *ngIf="hasUserRatings(myGameHistorique.myGame.game.id)">
                        <ng-container *ngFor="let userRating of userRatingAll">
                          <ng-container *ngIf="userRating.game.id == myGameHistorique.myGame.game.id">{{ userRating.rating }}</ng-container>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="!hasUserRatings(myGameHistorique.myGame.game.id)">na</ng-container>
                    </ng-container>
                  </span>/20</p>
                </div>
                <div class="card-action">
                  <i (click)="togglePin(myGameHistorique); $event.stopPropagation()" class="ri-pushpin-line"></i>
                  <i (click)="setModal(myGameHistorique.myGame.game); $event.stopPropagation(); " data-bs-toggle="modal" data-bs-target="#noteGame" class="ri-star-line"></i>
                  <i routerLink="edit/{{ myGameHistorique.id }}" class="ri-pencil-line"></i>
                  <!--                <i id="delete-comment-icon" class="ri-delete-bin-line" style="color: red;"-->
                  <!--                (click)="deleteFromMyGame(myGameHistorique.myGame.game.id)"></i>-->
                </div>
              </div>
            </div>

          </div>
        </div>

      </ng-container>
    </div>

  </ng-container>

  <!-- PAGE RECENT -->
  <ng-container *ngIf="task == 'recent'">
    <!-- Contenu de la page "recent" -->
  </ng-container>

</section>



























<!-- OLD MODALES -->

<!-- MODALE POUR AJOUTER UNE NOTE À UN NOUVEAU JEU -->
<div class="modal fade text-center" id="noteGamePage" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button (click)="unselectGame()" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="noteGamePage2" #noteGamePage2="ngForm" (ngSubmit)="addNote(noteGamePage2)" class="modal-body" style="padding-top: 40px;">

        <h2>Ajoutez une note à votre jeu</h2>

        <br>
        <h5><span style="color: red">*</span>Recherchez un jeu :</h5>
        <input *ngIf="this.gameSelected" type="text" placeholder="Votre jeu" disabled value="{{ this.gameSelected?.name }}">
        <input *ngIf="!this.gameSelected" type="text" placeholder="Tapez pour rechercher un jeu" name="searchValue" ngModel (keyup)="onSubmitSearch(noteGamePage2)">
        <br>

        <div *ngIf="searchResults && searchResults.length > 0 && !this.gameSelected" class="row">
          <div class="col-md-4" *ngFor="let result of searchResults">
            <div class="card mb-4 shadow-sm" (click)="selectGame(result)">
              <img [src]="result.image.icon_url" class="bd-placeholder-img card-img-top" alt="Image du jeu">
              <div class="card-body">
                <p class="card-text">{{ result.name }}</p>
              </div>
            </div>
          </div>
        </div>

        <br>
        <h6><span style="color: red">*</span>Note de votre jeu :</h6>
        <input type="number" placeholder="10" name="noteGame" ngModel>/20

        <div class="modal-footer" style="margin-top: 74px;">
          <button type="submit" class="btn btn-success" data-bs-dismiss="modal">Enregistrer</button>
          <button (click)="unselectGame()" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>

      </form>
    </div>
  </div>
</div>



