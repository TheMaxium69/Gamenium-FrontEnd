<!-- MODALE -->
<modal-view-mygame></modal-view-mygame>

<!-- CONTENT -->
<section id="profilWrapper" class="container">

  <app-tab-public></app-tab-public>
   <!-- SECTION BARRE DE RECHERCHE -->

   <div class="search-container">
    <div class="icon-container" [ngStyle]="{ 'background-color': isColor }">
      <i class="ri-search-2-line ico1"></i>
    </div>
    <input
      type="text"
      class="search-input"
      placeholder="Recherche dans vos jeux"
      [(ngModel)]="searchQuery"
      (input)="filterGames()"
    />

    <div class="filter-dropdown show">
      <button class="filter-button" (click)="toggleFilterDropdown()">
        <i *ngIf="!isFilterApplied()"class="ri-filter-line"></i>
        <i *ngIf="isFilterApplied()"class="ri-filter-fill"></i>
      </button>
      <div class="dropdown-menu" *ngIf="isFilterDropdownOpen">
        <button (click)="setSortOption('name-asc')">Nom (A-Z)</button>
        <button (click)="setSortOption('name-desc')">Nom (Z-A)</button>
        <button (click)="setSortOption('year-asc')">Année de sortie (Croissant)</button>
        <button (click)="setSortOption('year-desc')">Année de sortie (Décroissant)</button>
        <button (click)="setSortOption('added-asc')">Date d'ajout (Croissant)</button>
        <button (click)="setSortOption('added-desc')">Date d'ajout (Décroissant)</button>
        <button (click)="setSortOption('added-desc')">Réinitialiser</button>
      </div>
    </div>
  </div>

  <!-- SECTION POUR JEUX FILTRER OU RECHERCHER -->
  <div id="show-game" class="d-flex container" *ngIf="getAllGamesToDisplay().length > 0">
    <ng-container *ngFor="let myGameHistorique of getAllGamesToDisplay()">
      <div class="card-wrapper">
        <div class="card-game container d-flex">
          <div class="isPinned" *ngIf="!isFilterApplied() && !searchQuery.trim() && myGameHistorique.myGame.is_pinned" style="background-color: {{ isColor }}">
            <p><i class="ri-pushpin-fill"></i></p>
          </div>

          <div class="card-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame" >
            <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url == 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
              <div class="image" style="background-image: url('https://tyrolium.fr/Contenu/Image/Soon.png')"></div>
              <div class="blur"></div>
              <img src="https://tyrolium.fr/Contenu/Image/Soon.png" alt="...">
            </ng-container>
            <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url != 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
              <div class="image" style="background-image: url('{{ myGameHistorique.myGame.game.image?.thumb_url }}')"></div>
              <div class="blur"></div>
              <img src="{{ myGameHistorique.myGame.game.image?.thumb_url }}" alt="...">
            </ng-container>
          </div>

          <div class="card-right d-flex">
            <div class="core-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame">
              <h2>{{ myGameHistorique.myGame.game.name }}</h2>
              <p style="color: {{ isColor }};" class="platform-names">
                {{ this.app.plateformeNameFormatage(myGameHistorique.myGame.plateform.name) }}
              </p>
              <p> Ajouté le : {{ myGameHistorique.myGame.added_at | date:'dd / MM / yyyy' }}</p>
            </div>
            <div class="core-right">
              <div class="card-note" style="background-color: {{ isColor }}">
                <p><span id="noteGame{{ myGameHistorique.myGame.game.id }}">
                      <ng-container *ngIf="!userRatingAll">na</ng-container>
                      <ng-container *ngIf="userRatingAll">
                        <ng-container *ngIf="hasUserRatings(myGameHistorique.myGame.game.id)">
                          <ng-container *ngFor="let userRating of userRatingAll">
                            <ng-container *ngIf="userRating.game.id == myGameHistorique.myGame.game.id">{{ userRating.rating }}</ng-container>
                          </ng-container>
                        </ng-container>
                        <ng-container *ngIf="!hasUserRatings(myGameHistorique.myGame.game.id)">na</ng-container>
                      </ng-container>
                    </span>/20</p>
              </div>
              <div class="card-action">
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </ng-container>
  </div>

  <!--  GAME PINED -->
  <div id="show-game" class="d-flex container pinned" *ngIf="!isFilterApplied() && !searchQuery.trim() && getPinnedGames().length > 0">
    <ng-container *ngFor="let myGameHistorique of getPinnedGames()">
      <div class="card-wrapper">
        <div class="card-game container d-flex">

          <div class="isPinned" style="background-color: {{ isColor }}">
            <p><i class="ri-pushpin-fill"></i></p>
          </div>

          <div class="card-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame" >
            <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url == 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
              <div class="image" style="background-image: url('https://tyrolium.fr/Contenu/Image/Soon.png')"></div>
              <div class="blur"></div>
              <img src="https://tyrolium.fr/Contenu/Image/Soon.png" alt="...">
            </ng-container>
            <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url != 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
              <div class="image" style="background-image: url('{{ myGameHistorique.myGame.game.image?.thumb_url }}')"></div>
              <div class="blur"></div>
              <img src="{{ myGameHistorique.myGame.game.image?.thumb_url }}" alt="...">
            </ng-container>
          </div>

          <div class="card-right d-flex">
            <div class="core-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame">
              <h2>{{ myGameHistorique.myGame.game.name }}</h2>
              <p style="color: {{ isColor }};" class="platform-names">
                {{ this.app.plateformeNameFormatage(myGameHistorique.myGame.plateform.name) }}
              </p>
              <p> Ajouté le : {{ myGameHistorique.myGame.added_at | date:'dd / MM / yyyy' }}</p>
            </div>
            <div class="core-right">
              <div class="card-note" style="background-color: {{ isColor }}">
                <p><span id="noteGame{{ myGameHistorique.myGame.game.id }}">
                    <ng-container *ngIf="!userRatingAll">na</ng-container>
                    <ng-container *ngIf="userRatingAll">
                      <ng-container *ngIf="hasUserRatings(myGameHistorique.myGame.game.id)">
                        <ng-container *ngFor="let userRating of userRatingAll">
                          <ng-container *ngIf="userRating.game.id == myGameHistorique.myGame.game.id">{{ userRating.rating }}</ng-container>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="!hasUserRatings(myGameHistorique.myGame.game.id)">na</ng-container>
                    </ng-container>
                  </span>/20</p>
              </div>
              <div class="card-action">
              </div>
            </div>
          </div>

        </div>
      </div>

    </ng-container>
  </div>

  <!-- UNPINNED GAME -->
  <div id="show-game" class="d-flex container" *ngIf="!isFilterApplied() && !searchQuery.trim() && getUnpinnedGames().length > 0">
    <ng-container *ngFor="let myGameHistorique of getUnpinnedGames()">
      <div class="card-wrapper">
        <div class="card-game container d-flex">

          <div class="card-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame">
            <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url == 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
              <div class="image" style="background-image: url('https://tyrolium.fr/Contenu/Image/Soon.png')"></div>
              <div class="blur"></div>
              <img src="https://tyrolium.fr/Contenu/Image/Soon.png" alt="...">
            </ng-container>
            <ng-container *ngIf="myGameHistorique.myGame.game.image.icon_url != 'https://www.giantbomb.com/a/uploads/square_avatar/11/110673/3026329-gb_default-16_9.jpg'">
              <div class="image" style="background-image: url('{{ myGameHistorique.myGame.game.image?.thumb_url }}')"></div>
              <div class="blur"></div>
              <img src="{{ myGameHistorique.myGame.game.image?.thumb_url }}" alt="...">
            </ng-container>
          </div>

          <div class="card-right d-flex">
            <div class="core-left" (click)="selectViewMyGame(myGameHistorique); $event.stopPropagation()" data-bs-toggle="modal" data-bs-target="#viewGame">
              <h2>{{ myGameHistorique.myGame.game.name }}</h2>
              <p style="color: {{ isColor }};" class="platform-names">
                {{ this.app.plateformeNameFormatage(myGameHistorique.myGame.plateform.name) }}
              </p>
              <p> Ajouté le : {{ myGameHistorique.myGame.added_at | date:'dd / MM / yyyy' }}</p>
            </div>
            <div class="core-right">
              <div class="card-note" style="background-color: {{ isColor }}">
                <p><span id="noteGame{{ myGameHistorique.myGame.game.id }}">
                    <ng-container *ngIf="!userRatingAll">na</ng-container>
                    <ng-container *ngIf="userRatingAll">
                      <ng-container *ngIf="hasUserRatings(myGameHistorique.myGame.game.id)">
                        <ng-container *ngFor="let userRating of userRatingAll">
                          <ng-container *ngIf="userRating.game.id == myGameHistorique.myGame.game.id">{{ userRating.rating }}</ng-container>
                        </ng-container>
                      </ng-container>
                      <ng-container *ngIf="!hasUserRatings(myGameHistorique.myGame.game.id)">na</ng-container>
                    </ng-container>
                  </span>/20</p>
              </div>
              <div class="card-action">
              </div>
            </div>
          </div>

        </div>
      </div>

    </ng-container>
  </div>

</section>
